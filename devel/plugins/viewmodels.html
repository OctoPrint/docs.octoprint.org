

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Viewmodels &mdash; OctoPrint devel documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/mermaid.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plugin Tutorial" href="gettingstarted.html" />
    <link rel="prev" title="Injected Properties" href="injectedproperties.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OctoPrint
          

          
          </a>

          
            
            
              <div class="version">
                devel
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../features/index.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bundledplugins/index.html">Bundled Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../events/index.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developing Plugins</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="concepts.html">General Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="controlproperties.html">Control Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixins.html">Mixins</a></li>
<li class="toctree-l2"><a class="reference internal" href="hooks.html">Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="helpers.html">Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="injectedproperties.html">Injected Properties</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Viewmodels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#registering-custom-viewmodels">Registering custom viewmodels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#callbacks">Callbacks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lifecycle-diagrams">Lifecycle diagrams</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#web-interface-startup">Web interface startup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#web-interface-reconnect">Web interface reconnect</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gettingstarted.html">Plugin Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributing.html">Distributing your plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="python3_migration.html">Migrating to Python 3</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">Internal Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jsclientlib/index.html">JavaScript Client Library</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OctoPrint</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">


  <p style="padding: 10px;margin: 0 0 10px 0;border-radius: 2px;letter-spacing: 1px;font-size: 13px;color: white;text-align: center;background: #3a87ad;background-image: none;background-size: auto;background-size: 28px 28px;background-image: linear-gradient( -45deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.2) 50%, rgba(255, 255, 255, 0.2) 75%, transparent 75%, transparent );">
    <strong>Note:</strong>
    These are not the docs of the latest released version. Those can be found <a href="https://docs.octoprint.org/en/1.6.1" style="color: white;text-decoration: underline">here</a>.
  </p>


  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developing Plugins</a> &raquo;</li>
        
      <li>Viewmodels</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/plugins/viewmodels.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="viewmodels">
<span id="sec-plugins-viewmodels"></span><h1>Viewmodels<a class="headerlink" href="#viewmodels" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#registering-custom-viewmodels" id="id2">Registering custom viewmodels</a></p></li>
<li><p><a class="reference internal" href="#dependencies" id="id3">Dependencies</a></p></li>
<li><p><a class="reference internal" href="#callbacks" id="id4">Callbacks</a></p></li>
<li><p><a class="reference internal" href="#lifecycle-diagrams" id="id5">Lifecycle diagrams</a></p>
<ul>
<li><p><a class="reference internal" href="#web-interface-startup" id="id6">Web interface startup</a></p></li>
<li><p><a class="reference internal" href="#web-interface-reconnect" id="id7">Web interface reconnect</a></p></li>
</ul>
</li>
</ul>
</div>
<p>When implementing frontend components, you’ll sooner or later want to define your own <a class="reference external" href="http://knockoutjs.com/">KnockoutJS view models</a>
in order to provide custom functionality.</p>
<div class="section" id="registering-custom-viewmodels">
<span id="sec-plugins-viewmodels-registering"></span><h2><a class="toc-backref" href="#id2">Registering custom viewmodels</a><a class="headerlink" href="#registering-custom-viewmodels" title="Permalink to this headline">¶</a></h2>
<p>Register your view model with OctoPrint’s web app by pushing a config object unto the global array <code class="docutils literal notranslate"><span class="pre">OCTOPRINT_VIEWMODELS</span></code>.</p>
<p>Possible properties in this config object are:</p>
<dl class="simple">
<dt>construct</dt><dd><p>Function to use for constructing the view model instance. Usually that will be the view model class, which acts as
a constructor. This property is mandatory.</p>
</dd>
<dt>name</dt><dd><p>Name to register the view model under. If not provided, the name of the <code class="docutils literal notranslate"><span class="pre">construct</span></code> function will
be used, turning the first letter lower case. If a view model under the same name already exists at time
of construction, an error will be logged and the view model will not be instantiated.</p>
</dd>
<dt>additionalNames</dt><dd><p>A list of additional names to also register the view model under. Only those that do not already exist will be
registered.</p>
</dd>
<dt>dependencies</dt><dd><p>List of dependencies the view model needs injected. If any of the view models in this list cannot be found,
initialization of the view model will fail.  The parameters injected on instantiation will consist of first
the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code>, then the <code class="docutils literal notranslate"><span class="pre">optional</span></code> list concatenated.</p>
</dd>
<dt>optional</dt><dd><p>A list of optional dependencies the view model needs injected. If any of the view models in this list cannot be found,
they will be <code class="docutils literal notranslate"><span class="pre">null</span></code> in the parameter list injected to the constructor on instantiation. The parameters injected on
instantiation will consist of first the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code>, then the <code class="docutils literal notranslate"><span class="pre">optional</span></code> list concatenated.</p>
</dd>
<dt>elements</dt><dd><p>A list of UI elements to bind to. Each binding target can be either a string which will then be passed to jQuery’s
<code class="docutils literal notranslate"><span class="pre">$(...)</span></code> method to resolve the target, or alternatively directly a jQuery element</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">MyCustomViewModel</span><span class="p">(</span><span class="nx">parameters</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">loginState</span> <span class="o">=</span> <span class="nx">parameters</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span> <span class="c1">// requested as first dependency below</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">settings</span> <span class="o">=</span> <span class="nx">parameters</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span> <span class="c1">// requested as second dependency below</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">someOtherViewModel</span> <span class="o">=</span> <span class="nx">parameters</span><span class="p">[</span><span class="mf">2</span><span class="p">];</span> <span class="c1">// requested as first optional dependency below</span>

        <span class="c1">// more of your view model&#39;s implementation</span>
    <span class="p">}</span>

<span class="hll">    <span class="c1">// we don&#39;t explicitly declare a name property here</span>
</span><span class="hll">    <span class="c1">// our view model will be registered under &quot;myCustomViewModel&quot; (implicit</span>
</span><span class="hll">    <span class="c1">// name derived from constructor name) and &quot;yourCustomViewModel&quot; (explicitly</span>
</span><span class="hll">    <span class="c1">// provided as additional name)</span>
</span><span class="hll">    <span class="nx">OCTOPRINT_VIEWMODELS</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span class="hll">        <span class="nx">construct</span><span class="o">:</span> <span class="nx">MyCustomViewModel</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">additionalNames</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;yourCustomViewModel&quot;</span><span class="p">],</span>
</span><span class="hll">        <span class="nx">dependencies</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;loginStateViewModel&quot;</span><span class="p">,</span> <span class="s2">&quot;settingsViewModel&quot;</span><span class="p">],</span>
</span><span class="hll">        <span class="nx">optional</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;someOtherViewModel&quot;</span><span class="p">],</span>
</span><span class="hll">        <span class="nx">elements</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;#some_div&quot;</span><span class="p">,</span> <span class="s2">&quot;#some_other_div&quot;</span><span class="p">]</span>
</span><span class="hll">    <span class="p">});</span>
</span><span class="p">})</span>
</pre></div>
</div>
<p>You might also come across a different approach to view model declaration, providing not a config object but instead
a 3-tuple of constructor, dependencies and elements to bind to. Additional names, different names than the default name
and optional dependencies cannot be specified with this format. It should be considered deprecated. Still, an example
of how that would look in practice is provided here as well:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-number">Listing 38 </span><span class="caption-text">Old tuple-based configuration format, consider this deprecated</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">MyCustomViewModel</span><span class="p">(</span><span class="nx">parameters</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">loginState</span> <span class="o">=</span> <span class="nx">parameters</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span> <span class="c1">// requested as first constructor parameter below</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">settingsViewModel</span> <span class="o">=</span> <span class="nx">parameters</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="c1">// requested as second constructor parameter below</span>

        <span class="c1">// more of your view model&#39;s implementation</span>
    <span class="p">}</span>

<span class="hll">    <span class="c1">// construct, dependencies, elements</span>
</span><span class="hll">    <span class="nx">OCTOPRINT_VIEWMODELS</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span>
</span><span class="hll">        <span class="nx">MyCustomViewModel</span><span class="p">,</span>
</span><span class="hll">        <span class="p">[</span><span class="s2">&quot;loginStateViewModel&quot;</span><span class="p">,</span> <span class="s2">&quot;settingsViewModel&quot;</span><span class="p">],</span>
</span><span class="hll">        <span class="p">[</span><span class="s2">&quot;#some_div&quot;</span><span class="p">,</span> <span class="s2">&quot;#some_other_div&quot;</span><span class="p">]</span>
</span><span class="hll">    <span class="p">]);</span>
</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dependencies">
<span id="sec-plugins-viewmodels-dependencies"></span><h2><a class="toc-backref" href="#id3">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>OctoPrint will try to inject all view model dependencies requested by your view model. In order to do this it will
perform multiple passes iterating over all registered view models and collecting the necessary dependencies prior to
construction. Circular dependencies (A depends on B, B on C, C on A) naturally cannot be resolved and will cause an
error to be logged to the JavaScript console.</p>
<p>OctoPrint’s core currently comes with the following view models that your plugin can request for injection:</p>
<dl class="simple">
<dt>appearanceViewModel</dt><dd><p>View model that holds the appearance settings (name, color and transparency flag).</p>
</dd>
<dt>connectionViewModel</dt><dd><p>View model for the connection sidebar entry.</p>
</dd>
<dt>controlViewModel</dt><dd><p>View model for the control tab.</p>
</dd>
<dt>filesViewModel</dt><dd><p>View model for the files sidebar entry. Also available under the deprecated name <code class="docutils literal notranslate"><span class="pre">gcodeFilesViewModel</span></code>.</p>
</dd>
<dt>firstRunViewModel</dt><dd><p>View model for the first run dialog.</p>
</dd>
<dt>gcodeViewModel</dt><dd><p>View model for the gcode viewer tab.</p>
</dd>
<dt>gcodeFilesViewModel</dt><dd><p>Deprecated in favor of <code class="docutils literal notranslate"><span class="pre">filesViewModel</span></code>.</p>
</dd>
<dt>logViewModel</dt><dd><p>View model for the logfile settings dialog.</p>
</dd>
<dt>loginStateViewModel</dt><dd><p>View model for the current login state of the user, very interesting for plugins that need to
evaluate the current login state or information about the current user, e.g. associated roles.</p>
</dd>
<dt>navigationViewModel</dt><dd><p>View model for the navigation bar.</p>
</dd>
<dt>printerProfilesViewModel</dt><dd><p>View model for the printer profiles settings dialog.</p>
</dd>
<dt>printerStateViewModel</dt><dd><p>View model for the current printer state, very interesting for plugins that need
to know information about the current print job, if the printer is connected, operational etc.</p>
</dd>
<dt>settingsViewModel</dt><dd><p>View model for the settings dialog, also holds all settings to be used by other view models, hence
very interesting for plugins as well.</p>
</dd>
<dt>slicingViewModel</dt><dd><p>View model for the slicing dialog.</p>
</dd>
<dt>temperatureViewModel</dt><dd><p>View model for the temperature tab, also holds current temperature information which
might be interesting for plugins.</p>
</dd>
<dt>terminalViewModel</dt><dd><p>View model for the terminal tab, also holds terminal log entries.</p>
</dd>
<dt>timelapseViewModel</dt><dd><p>View model for the timelapse tab.</p>
</dd>
<dt>usersViewModel</dt><dd><p>View model for the user management in the settings dialog.</p>
</dd>
<dt>userSettingsViewModel</dt><dd><p>View model for settings associated with the currently logged in user, used for
the user settings dialog.</p>
</dd>
<dt>wizardViewModel</dt><dd><p>View model for the wizard dialog.</p>
</dd>
</dl>
<p>Each plugin’s view model will be added to the view model map used for resolving dependencies as well, using
the view model’s class name with a lower case first character as identifier (so “MyCustomViewModel” will be registered
for dependency injection as “myCustomViewModel”) or an alternative name provided in the <code class="docutils literal notranslate"><span class="pre">name</span></code> property of the
config object, plus any configured <code class="docutils literal notranslate"><span class="pre">additionalNames</span></code>.</p>
</div>
<div class="section" id="callbacks">
<span id="sec-plugins-viewmodels-callbacks"></span><h2><a class="toc-backref" href="#id4">Callbacks</a><a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h2>
<p>OctoPrint’s web application will call several callbacks on all registered view models, provided they implement them.
Those are listed below:</p>
<dl>
<dt>onStartup()</dt><dd><p>Called when the first initialization has been done. All view models are constructed and hence their dependencies
resolved, no bindings have been done yet.</p>
</dd>
<dt>onBeforeBinding()</dt><dd><p>Called per view model before attempting to bind it to its binding targets.</p>
</dd>
<dt>onAfterBinding()</dt><dd><p>Called per view model after binding it to its binding targets.</p>
</dd>
<dt>onAllBound(allViewModels)</dt><dd><p>Called after all view models have been bound, with the list of all view models as the single parameter.</p>
</dd>
<dt>onStartupComplete()</dt><dd><p>Called after the startup of the web app has been completed.</p>
</dd>
<dt>onServerDisconnect()</dt><dd><p>Called if a disconnect from the server is detected.</p>
</dd>
<dt>onDataUpdaterReconnect()</dt><dd><p>Called when the connection to the server has been reestablished after a disconnect.</p>
</dd>
<dt>fromHistoryData(data)</dt><dd><p>Called when history data is received from the server. Usually that happens only after initial connect in order to
transmit the temperature and terminal log history to the connecting client. Called with the <code class="docutils literal notranslate"><span class="pre">data</span></code> as single parameter.</p>
</dd>
<dt>fromCurrentData(data)</dt><dd><p>Called when current printer status data is received from the server with the <code class="docutils literal notranslate"><span class="pre">data</span></code> as single parameter.</p>
</dd>
<dt>onSlicingProgress(slicer, modelPath, machineCodePath, progress)</dt><dd><p>Called on slicing progress, call rate is once per percentage point of the progress at maximum.</p>
</dd>
<dt>onEvent&lt;EventName&gt;(payload)</dt><dd><p>Called on firing of an event of type <code class="docutils literal notranslate"><span class="pre">EventName</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">onEventPrintDone</span></code>. See <a class="reference internal" href="../events/index.html#sec-events-available-events"><span class="std std-ref">the list of available events</span></a>
for the possible events and their payloads.</p>
</dd>
<dt>fromTimelapseData(data)</dt><dd><p>Called when timelapse configuration data is received from the server. Usually that happens after initial connect.</p>
</dd>
<dt>onDataUpdaterPluginMessage(plugin, message)</dt><dd><p>Called when a plugin message is pushed from the server with the identifier of the calling plugin as first
and the actual message as the second parameter. Note that the latter might be a full fledged object, depending
on the plugin sending the message. You can use this method to asynchronously push data from your plugin’s server
component to its frontend component.</p>
</dd>
<dt>onUserLoggedIn(user)</dt><dd><p>Called when a user gets logged into the web app, either passively (upon initial load of the page due to a valid
“Remember Me” cookie) or due to an active completion of the login dialog. The user data of the just logged in user
will be provided as only parameter.</p>
</dd>
<dt>onUserLoggedOut()</dt><dd><p>Called when a user gets logged out of the web app.</p>
</dd>
<dt>onUserPermissionsChanged(user)</dt><dd><p>Called when a change in the permissions of the current user is detected. The user data of the just logged in user
will be provided as only parameter. Note that this may also be triggered for not logged in guests if the guest
group is modified. In this case <code class="docutils literal notranslate"><span class="pre">user</span></code> will be undefined.</p>
</dd>
<dt>onBeforePrintStart(callback)</dt><dd><p>Called before a print is started either by clicking the “Print” button in the state panel or the select &amp; print icon
in the file list. The callback to actually proceed with starting the print is provided as the only parameter. By returning
<code class="docutils literal notranslate"><span class="pre">false</span></code> from this, plugins may prevent a print from actually starting, optionally starting it at a later date by
calling <code class="docutils literal notranslate"><span class="pre">callback</span></code> themselves. This can be used for example to implement an additional confirmation dialog.</p>
</dd>
<dt>onTabChange(next, current)</dt><dd><p>Called before the main tab view switches to a new tab, so <cite>before</cite> the new tab becomes visible. Called with the
next (changed to) and current (still visible) tab’s hash (e.g. <code class="docutils literal notranslate"><span class="pre">#control</span></code>). Note that <code class="docutils literal notranslate"><span class="pre">current</span></code> might be undefined
on the very first call.</p>
</dd>
<dt>onAfterTabChange(current, previous)</dt><dd><p>Called after the main tab view switches to a new tab, so <cite>after</cite> the new tab becomes visible. Called with the
current and previous tab’s hash (e.g. <code class="docutils literal notranslate"><span class="pre">#control</span></code>).</p>
</dd>
<dt>getAdditionalControls()</dt><dd><p>Your view model may return additional custom control definitions for inclusion on the “Control” tab of OctoPrint’s
interface. See <a class="reference internal" href="../features/custom_controls.html#sec-features-custom-controls"><span class="std std-ref">the custom control feature</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Controls injected from a view model do not support feedback controls (as defined by
<code class="docutils literal notranslate"><span class="pre">regex</span></code> and <code class="docutils literal notranslate"><span class="pre">template</span></code>).</p>
</div>
</dd>
<dt>onSettingsShown()</dt><dd><p>Called when the settings dialog is shown.</p>
</dd>
<dt>onSettingsHidden()</dt><dd><p>Called when the settings dialog is hidden.</p>
</dd>
<dt>onSettingsBeforeSave()</dt><dd><p>Called just before the settings view model is sent to the server. This is useful, for example, if your plugin
needs to compute persisted settings from a custom view model.</p>
</dd>
<dt>onUserSettingsShown()</dt><dd><p>Called when the user settings dialog is shown.</p>
</dd>
<dt>onUserSettingsHidden()</dt><dd><p>Called when the user settings dialog is hidden.</p>
</dd>
<dt>onUserSettingsBeforeSave()</dt><dd><p>Called just before the user settings view model is sent to the server. This is useful, for example, if your plugin
needs to compute persisted settings from a custom view model.</p>
</dd>
<dt>onWizardDetails(response)</dt><dd><p>Called with the response from the wizard detail API call initiated before opening the wizard dialog. Will contain
the data from all <a class="reference internal" href="mixins.html#octoprint.plugin.WizardPlugin" title="octoprint.plugin.WizardPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">WizardPlugin</span></code></a> implementations returned by their <a class="reference internal" href="mixins.html#octoprint.plugin.WizardPlugin.get_wizard_details" title="octoprint.plugin.WizardPlugin.get_wizard_details"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_wizard_details()</span></code></a>
method, mapped by the plugin identifier.</p>
</dd>
<dt>onBeforeWizardTabChange(next, current)</dt><dd><p>Called before the wizard tab/step is changed, with the ids of the next (changed to) and the current (still visible) tab
as parameters. Return false in order to prevent the tab change, e.g. if the wizard step is mandatory and not yet
completed by the user. Take a look at the “Core Wizard” plugin bundled with OctoPrint and the ACL wizard step in
particular for an example on how to use this.</p>
</dd>
<dt>onAfterWizardTabChange(current)</dt><dd><p>Called after the wizard tab/step is changed, with the id of the current tab as parameter. The id of the previous
tab is sadly not available currently.</p>
</dd>
<dt>onBeforeWizardFinish()</dt><dd><p>Called before executing the finishing of the wizard. Return false here to stop the actual finish, e.g. if some step is
still incomplete.</p>
</dd>
<dt>onWizardFinish()</dt><dd><p>Called after executing the finishing of the wizard and before closing the dialog. Return <code class="docutils literal notranslate"><span class="pre">reload</span></code> here in order to
instruct OctoPrint to reload the UI after the wizard closes.</p>
</dd>
</dl>
<p>In order to hook into any of those callbacks, just have your view model define a function named accordingly, e.g.
to get called after all view models have been bound during application startup, implement a function <code class="docutils literal notranslate"><span class="pre">onAllBound</span></code>
on your view model, taking a list of all bound view models:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">MyCustomViewModel</span><span class="p">(</span><span class="nx">parameters</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="c1">// ...</span>

<span class="hll">        <span class="nx">self</span><span class="p">.</span><span class="nx">onAllBound</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">allViewModels</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="c1">// do something with them</span>
</span>        <span class="p">}</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="nx">OCTOPRINT_VIEWMODELS</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">construct</span><span class="o">:</span> <span class="nx">MyCustomViewModel</span><span class="p">,</span>
        <span class="nx">dependencies</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;loginStateViewModel&quot;</span><span class="p">],</span>
        <span class="nx">elements</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;#some_div&quot;</span><span class="p">,</span> <span class="s2">&quot;#some_other_div&quot;</span><span class="p">]</span>
    <span class="p">});</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="lifecycle-diagrams">
<span id="sec-plugins-viewmodels-livecycle"></span><h2><a class="toc-backref" href="#id5">Lifecycle diagrams</a><a class="headerlink" href="#lifecycle-diagrams" title="Permalink to this headline">¶</a></h2>
<div class="section" id="web-interface-startup">
<span id="sec-plugins-viewmodels-startup"></span><h3><a class="toc-backref" href="#id6">Web interface startup</a><a class="headerlink" href="#web-interface-startup" title="Permalink to this headline">¶</a></h3>
<object data="../_images/mermaid-4fd41888a15fa9877db93b5414f72704048b4f41.svg" type="image/svg+xml">
            <p class="warning">sequenceDiagram
   participant Main
   participant DataUpdater
   participant LoginStateViewModel
   participant SettingsViewModel
   participant UiStateViewModel

   Note over DataUpdater: connectCallback = undefined
   Note over UiStateViewModel: loaded = false

   activate Main

   Main-&gt;&gt;+DataUpdater: connect
   Note right of DataUpdater: initialized = false
   DataUpdater--&gt;&gt;Main: ok
   deactivate Main
   DataUpdater-&gt;&gt;DataUpdater: asynchronous connect to server...
   activate DataUpdater
   Note right of DataUpdater: store any callbacks instead of triggering (e.g. onServerConnect, fromHistoryData, fromCurrentData, ...)
   DataUpdater-X+Main: done
   deactivate DataUpdater
   deactivate DataUpdater

   Main-&gt;&gt;+DataUpdater: connectCallback = onServerConnect
   Note right of DataUpdater: connectCallback = onServerConnect
   DataUpdater--&gt;&gt;-Main: ok
   Main-&gt;&gt;+Main: onServerConnect
   Main-&gt;&gt;+LoginStateViewModel: passiveLogin
   LoginStateViewModel--&gt;&gt;Main: ok
   Main--&gt;&gt;Main: ok
   deactivate Main
   deactivate Main

   LoginStateViewModel-&gt;&gt;+LoginStateViewModel: asynchronous passive login
   Note over Main,UiStateViewModel: Session available!
   LoginStateViewModel-X+Main: done
   deactivate LoginStateViewModel
   deactivate LoginStateViewModel

   Main-&gt;&gt;+DataUpdater: initialized
   Note right of DataUpdater: initialized = true
   DataUpdater-&gt;DataUpdater: trigger stored callbacks
   DataUpdater--&gt;&gt;-Main: ok

   Main-&gt;&gt;+Main: fetchSettings
   Note right of Main: trigger onStartup

   Main-&gt;&gt;+SettingsViewModel: requestData
   SettingsViewModel--&gt;&gt;Main: ok
   deactivate Main
   deactivate Main

   SettingsViewModel-&gt;&gt;+SettingsViewModel: asynchronous settings fetch
   Note over Main,UiStateViewModel: Settings available!
   SettingsViewModel-X+Main: done
   deactivate SettingsViewModel
   deactivate SettingsViewModel

   Main-&gt;&gt;+Main: bindViewModels

   loop for each view model
       Main-&gt;Main: trigger onBeforeBinding
       Main-&gt;Main: trigger onBoundTo
       Main-&gt;Main: trigger onAfterBinding
   end

   Main-&gt;Main: trigger onAllBound
   opt User is logged in
      Main-&gt;&gt;+LoginStateViewModel: onAllBound
      LoginStateViewModel-&gt;LoginStateViewModel: trigger onUserLoggedIn
      LoginStateViewModel--&gt;&gt;-Main: ok
   end

   Main-&gt;&gt;+UiStateViewModel: loaded
   Note right of UiStateViewModel: loaded = true
   UiStateViewModel--&gt;&gt;-Main: ok

   Main-&gt;Main: trigger onStartupComplete
   deactivate Main
   deactivate Main</p></object>
</div>
<div class="section" id="web-interface-reconnect">
<span id="sec-plugins-viewmodels-reconnect"></span><h3><a class="toc-backref" href="#id7">Web interface reconnect</a><a class="headerlink" href="#web-interface-reconnect" title="Permalink to this headline">¶</a></h3>
<object data="../_images/mermaid-b6a68afb5de22645f94737e480e580e570c977a7.svg" type="image/svg+xml">
            <p class="warning">sequenceDiagram
   participant onServerConnect
   participant DataUpdater
   participant LoginStateViewModel

   activate DataUpdater
   DataUpdater-&gt;&gt;DataUpdater: call connectCallback
   DataUpdater-&gt;&gt;+onServerConnect: call
   onServerConnect--&gt;&gt;DataUpdater: ok
   deactivate DataUpdater

   onServerConnect-&gt;&gt;+LoginStateViewModel: passiveLogin
   LoginStateViewModel--&gt;&gt;onServerConnect: ok
   deactivate onServerConnect
   LoginStateViewModel-&gt;&gt;+LoginStateViewModel: asynchronous passive login
   Note over onServerConnect,LoginStateViewModel: Session available!
   opt User is logged in
      LoginStateViewModel-&gt;LoginStateViewModel: trigger onUserLoggedIn
   end

   activate onServerConnect
   LoginStateViewModel-XonServerConnect: done
   deactivate LoginStateViewModel
   deactivate LoginStateViewModel

   onServerConnect-&gt;&gt;+DataUpdater: initialized
   DataUpdater-&gt;DataUpdater: trigger stored callbacks
   DataUpdater--&gt;&gt;onServerConnect: ok
   deactivate DataUpdater
   deactivate onServerConnect</p></object>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference external" href="https://github.com/OctoPrint/OctoPrint/tree/master/src/octoprint/static/js/app/viewmodels">OctoPrint’s core viewmodels</a></dt><dd><p>OctoPrint’s own view models use the same mechanisms for interacting with each other and the web application as
plugins. Their source code is therefore a good point of reference on how to achieve certain things.</p>
</dd>
<dt><a class="reference external" href="http://knockoutjs.com/documentation/introduction.html">KnockoutJS documentation</a></dt><dd><p>OctoPrint makes heavy use of KnockoutJS for building up its web app.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="gettingstarted.html" class="btn btn-neutral float-right" title="Plugin Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="injectedproperties.html" class="btn btn-neutral float-left" title="Injected Properties" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2013-2021, Gina Häußge.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: devel
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="https://docs.octoprint.org/en/1.5.3/plugins/viewmodels.html">1.5.3</a></dd>
      <dd><a href="https://docs.octoprint.org/en/1.6.1/plugins/viewmodels.html">1.6.1</a></dd>
      <dd><a href="https://docs.octoprint.org/en/1.7.0rc1/plugins/viewmodels.html">1.7.0rc1</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="https://docs.octoprint.org/en/master/plugins/viewmodels.html">master</a></dd>
      <dd><a href="https://docs.octoprint.org/en/maintenance/plugins/viewmodels.html">maintenance</a></dd>
      <dd><a href="https://docs.octoprint.org/en/devel/plugins/viewmodels.html">devel</a></dd>
    </dl>
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>